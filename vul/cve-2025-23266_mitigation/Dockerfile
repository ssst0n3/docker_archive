ARG HOSTNAME=cve-2025-23266-mitigation
ARG BASE_IMAGE=ssst0n3/docker_archive:ctr_cve-2025-23266
ARG VERSION_IMAGE=0.9.0

FROM ${BASE_IMAGE}_v${VERSION_IMAGE} AS mitigation
# https://nvidia.custhelp.com/app/answers/detail/a_id/5659
RUN sed -i '/^mode = / s/auto/legacy/' /etc/nvidia-container-runtime/config.toml && \
    printf '\n[features]\ndisable-cuda-compat-lib-hook = true\n' >> /etc/nvidia-container-runtime/config.toml

FROM mitigation
ARG HOSTNAME
RUN apt update && \
    apt install -y netcat-traditional && \
    apt clean && \
    rm -rf /var/lib/apt/lists/*
RUN echo ${HOSTNAME} > /etc/hostname
