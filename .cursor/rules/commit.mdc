---
alwaysApply: true
---

# Git Commit Message Generation Rules

You are a senior software engineer and Git expert. Your task is to generate semantic, detailed, and professional Git commit messages based on staged changes.

## 1. Analysis & Atomicity
- **Analyze Staged Changes**: Carefully examine specific files, code logic, and configuration changes.
- **Check Atomicity**:
  - If changes are logically separate (e.g., containing both a CSS fix and a database migration), suggest splitting the commit and list the recommended file groupings.
  - If changes are related, proceed with generating a single commit message.

## 2. Commit Message Format
Strictly follow the **Conventional Commits** standard.

```text
<type>(<scope>): <subject>

<body>
```

### Title Line (<type>(<scope>): <subject>)
- **Type**: `feat` (new feature), `fix` (bug fix), `docs` (documentation), `style` (formatting), `refactor` (refactoring), `perf` (performance), `test` (testing), `build` (build system), `ci` (CI/CD), `chore` (maintenance), `revert` (revert).
- **Scope**: (Optional) Affected module (e.g., `auth`, `api`, `ssh`).
- **Subject**:
  - Use imperative mood (e.g., "add" instead of "added").
  - Do not end with a period.
  - **Keep length within 50-72 characters**. Be concise.

### Body - Required for Complex Changes
- **When to Use**: If changes involve specific logic, environment variables, multiple component interactions, or breaking changes.
- **Content Requirements**: Explain *what changed* and *why it changed*.
- **Line Wrapping**: Wrap at 72 characters.

## 3. Content Guidelines (Core Requirements)
- **Information Parity**: The generated English commit message must convey **the same level of technical detail** as the Chinese summary.
- **Specific Details**: If the Chinese summary mentions specific environment variables (such as `SKIP_SSH_CONFIG`), specific file paths, or specific algorithm logic, these **must** be included in the English message (usually in the Body section).
- **Avoid Over-Simplification**: Do not sacrifice technical accuracy for brevity.

## 4. Output Workflow
Before asking whether to commit, first display the "review block".

**Output Template:**

```text
Files staged. Generating commit message:
Review / Confirm:
Chinese Summary: <Generate a detailed Chinese summary here, including variable names, logic details, and other technical points>
English Draft:
<type>(<scope>): <subject>

<body - Detailed English explanation that must include all technical details mentioned in the Chinese summary>
```

## 5. Commit Execution Protocol

### 5.1 File-based Commit

**Must use file-based commit to avoid command-line quote issues.**

- **Forbidden**: `git commit -m "message"` or `git commit -m 'message'`
- **Required**: `git commit -F <file>` to read commit message from file
- **Commit Message File**: Use `.commit-message` as the temporary file path (in project root directory)

### 5.2 Execution Flow

1. **Create Temporary File**: Use file editing tools (such as `write`) to directly write the complete commit message to `.commit-message` file
   - **Forbidden**: `echo`, `printf` and other shell commands (may encounter quote escaping issues)
   - **Required**: File editing tools (`write`) to directly write file content
2. **Commit Using File**: Execute `git commit -F .commit-message`
3. **Clean Up File**: Delete `.commit-message` file after commit is complete

### 5.3 Strict Consistency

If the user replies with "confirm", "yes", or similar affirmative instructions, the information used when executing `git commit` must be **exactly consistent** (literal match) with the content displayed in **English Draft**. **Forbidden** to modify, polish, reduce, or reformat the commit message in any form after user confirmation.

---

**Correct Behavior Examples:**

**Example 1: Simple Scenario (Title Line Only)**

*Scenario*: Fix button click style issue.

*Output*:
Review / Confirm:
Chinese Summary: Fix button click style issue, ensuring visual feedback is correctly displayed in the clicked state.
English Draft:
fix(ui): correct button click style feedback

---

**Example 2: Complex Scenario (Requires Body, Contains Technical Details)**

*Scenario*: Fix API authentication token expiration handling, involving modifications to multiple files and functions.

*Output*:
Review / Confirm:
Chinese Summary: Fix API authentication token expiration handling issue. Added token expiration check logic in the `validateToken()` function in `src/api/auth.ts`. When the token exceeds the expiration time set by the `JWT_EXPIRY_TIME` environment variable (default: 3600 seconds), automatically calls `refreshToken()` to refresh the token. Also updated the `getAuthConfig()` function in `src/config.ts` to correctly read the `JWT_EXPIRY_TIME` configuration.
English Draft:
fix(auth): handle token expiration with auto-refresh

Adds expiration check logic in `validateToken()` function within
`src/api/auth.ts`. When token exceeds the expiry time set by
`JWT_EXPIRY_TIME` environment variable (default: 3600 seconds),
automatically calls `refreshToken()` to refresh the token. Also updates
`getAuthConfig()` function in `src/config.ts` to correctly read the
`JWT_EXPIRY_TIME` configuration.
